<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
  <title>Chatrooms</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type ="text/javascript" src="/socket.io/socket.io.js"></script>
    <script type="text/javascript">
        var socket = io();
        var current_user;

        var new_user = function() {
        var name = prompt('What is your name?');
        $("#btn").click(function(){
            socket.emit("got_a_new_user", {user: name});
          });
        new_user();
          socket.on("existing_user", function(data){
            $("#error").html(data.error)
            new_user();
        })
        socket.on("load_messages", function(data){
      $("#error").html("")
      current_user = data.current_user;
      var messages = data.messages;
      var messageThread = "";

      for (var i = 0; i < messages.length; i++){
        messageThread += "<p>" + messages[i].name + ": " + messages[i].message + "</p>";
      }

      $("#message_board").append(messageThread);
    })

    $("#new_message").submit(function(){
      socket.emit("new_message", {message: $("#message").val(), user: current_user})
      return false;
    })

    socket.on("post_new_message", function(data) {
      $("#message_board").append("<p>" + data.user + ": " + data.new_message + "</p>");
    });
  }
    </script>
</head>
<body>
  <div class="container">
    <div id="error"></div>
    <h2>The page at https says:</h2>
    <p>Your Name:</p>
    <p><input type="text" id="name" class="form-control"></p>
    <p><button class="btn btn-primary">Cancel</button>|<button id="btn" class="btn btn-success">Ok</button></p>
    <p>Users</p>
    <div id="message_board"></div>
    <form id="new_message">
      <input class="form-control" type="text" id="message" placeholder="enter your message here">
      <input class="btn btn-primary" type="submit" value="Send">
    </form>
  </div>
</body>
</html>
